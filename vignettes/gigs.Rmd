---
title: "Introduction to gigs"
description: >
  Learn how to get started with the basics of gigs.
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to gigs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r knitr_opts, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

gigs is designed to make working with outputs from either the
INTERGROWTH-21<sup>st</sup> project and World Health Organisation Child Growth
Standards as easy as possible. It also provides functions for easy and
reproducible classification of newborn and infant growth.

Which functions you want to use depend on whether you're **converting between
values and z-scores/percentiles**, or **classifying observations**. Let's start
by loading the package.

```{r setup}
library(gigs)
```

## Converting between z-scores/percentiles and values

### From values to z-scores/percentiles
Much of the time, you'll want to know where a measurement for a given
observation lies relative to 'expected' values for that observation. This is
where the `value2zscore` and `value2percentile` functions are useful:

#### Example 1a: Converting newborn weights
```{r example_1a}
df_newborn_weights <- data.frame(
        weight_kg = c(0.91, 3.33, 2.75, 3.35, 3.47, 1.90),
        gest_age = c(183, 280, 293, 259, 277, 231),
        sex = c(rep("M", 3), rep("F", 3))
)
df_newborn_weights$weight_p <-
  with(df_newborn_weights,
       ig_nbs_value2percentile(y = weight_kg,
                               gest_age = gest_age,
                               sex = sex,
                               acronym = "wfga")) |>
        round(digits = 2)

df_newborn_weights$weight_z <-
    with(df_newborn_weights,
       ig_nbs_value2zscore(y = weight_kg,
                               gest_age = gest_age,
                               sex = sex,
                               acronym = "wfga")) |>
        round(digits = 2)
df_newborn_weights
```

Given that the outputs of these functions are vectors, gigs functions integrate
easily with [dplyr](https://dplyr.tidyverse.org/) verbs. We only avoid using
them here to reduce the package dependencies for gigs.

### From z-scores/percentiles to values
Alternatively, you may wish to calculate reference values for median head
circumference in female newborns across a range of gestational ages. You can do
this with the relevant `percentile2value` function:
```{r conversion_hcfga}
ig_nbs_hcfga_percentile2value(p = 0.5,
                              gest_age = 266:272,
                              sex = "M") |>
        round(digits = 1)
```

## Classifying observations
Sometimes it is more valuable to classify observed z-scores/percentiles than to
work with the raw values, for example when evaluating size for gestational age
in newborns. The classification functions offered by this package allow the user
to easily classify growth status:

### Size-for-gestational age
The `classify_sga()` function offers size-for-GA classifications based on
cut-offs from the research literature. Typically, the 10<sup>th</sup> and
90<sup>th</sup> centiles are used as the size-for-GA cut-offs, but some
publications also specify severely small-for-GA newborns as those below the
third weight-for-GA centile. Whether you do this depends on the `coarse`
parameter in `classify_sga()`:
```{r example_2}
df_newborn_weights$sga <- with(
        df_newborn_weights,
        classify_sga(weight_kg = weight_kg, gest_age = gest_age, sex = sex))
df_newborn_weights$sga_coarse <- with(
        df_newborn_weights,
        classify_sga(weight_kg = weight_kg,
                     gest_age = gest_age,
                     sex = sex,
                     severe = FALSE))
df_newborn_weights
```

### Stunting
The `classify_stunting()` function offers stunting (length/height-for-age)
classifications based on cut-offs from the research literature. The output is a
factor with levels corresponding to either different degrees of stunting:
```{r example_stunting}
classify_stunting(
  lenht_cm = c(52.2, 75.4, 63.1),
  age_days = c(357, 375, 250),
  ga_at_birth = c(196, 287, 266),
  sex = c("M", "M", "F"),
  lenht_method = c("H", "H", "H")
)
```

### Wasting
The `classify_wasting()` function offers wasting (weight-for-length)
classifications based on cut-offs from the research literature. The output is a
factor with levels corresponding to either different degrees of wasting:
```{r example_wasting}
classify_wasting(
  weight_kg = c(5.75, 2.18, 3.00, 6.75),
  lenht_cm = c(67.7, 46.6, 50.0, 80.1),
  sex =  c("F", "M", "F", "M"),
  lenht_method = c("H", "L", NA_character_, "H")
)
```

### Weight-for-age
The `classify_wfa()` function offers weight-for-age classifications based on
cut-offs from the research literature. The output is a factor with levels
corresponding to either different degrees of underweight and overweight:
```{r example_weight_for_age}
classify_wfa(
  weight_kg = c(7.2, 4.5, 9.1, 24),
  age_days = c(401, 185, 101, 607),
  ga_at_birth = 7 * c(27, 36, 40, 41),
  sex = c("F", "M", "F", "M")
)
```




